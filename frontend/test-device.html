<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch sử thiết bị</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }

        /* Thanh navbar */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #333;
            padding: 20px 20px;
            color: white;
        }

        .navbar h1 {
            margin: 0;
            font-size: 24px;
        }

        .navbar .nav-buttons {
            display: flex;
            gap: 20px;
        }

        .navbar .nav-buttons button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 999px;
            background-color: #4CAF50;
            color: white;
        }

        .navbar .nav-buttons button:hover {
            background-color: #45a049;
        }

        .navbar .nav-buttons button:active {
            background-color: #3e8e41;
        }

        /* CSS for header title */
        .header-title {
            text-align: center;
            margin: 20px 0;
        }

        .header-title h2 {
            font-size: 24px;
            color: #333;
        }

        /* CSS for container and table */
        .container {
            width: 80%;
            margin: 0 auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table th,
        table td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: center;
        }

        table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .pagination {
            margin-top: 20px;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .pagination button {
            padding: 10px 20px;
            margin: 0 5px;
            border: 1px solid #ddd;
            background-color: #fff;
            cursor: pointer;
            border-radius: 5px;
        }

        .pagination button.active {
            background-color: #007bff;
            color: #fff;
        }

        /* CSS cho khối lọc */
        .filter-find-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 20px;
            /* Tăng độ dày của padding */
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            height: 70px;
            /* Thêm chiều cao cho thanh chứa */
        }

        .filter-container,
        .find-container {
            display: flex;
            align-items: center;
        }

        .filter-container label,
        .find-container label {
            margin-right: 10px;
            font-weight: bold;
            color: #333;
            font-size: 16px;
            /* Tăng cỡ chữ */
        }

        .filter-container input,
        .find-container select {
            padding: 8px;
            /* Tăng padding để cân đối với cỡ chữ */
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 10px;
            font-size: 16px;
            /* Tăng cỡ chữ */
        }

        .filter-container input {
            width: 180px;
            /* Điều chỉnh lại kích thước để phù hợp với cỡ chữ */
        }

        .find-container select {
            width: 220px;
            /* Điều chỉnh lại kích thước để phù hợp với cỡ chữ */
        }

        #applyFilter {
            padding: 8px 20px;
            /* Tăng padding để cân đối với cỡ chữ */
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            /* Tăng cỡ chữ */
            transition: background-color 0.3s;
        }

        #applyFind {
            padding: 8px 20px;
            /* Tăng padding để cân đối với cỡ chữ */
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            /* Tăng cỡ chữ */
            transition: background-color 0.3s;
        }

        #applyFilter:hover {
            background-color: #0056b3;
        }

        #applyFind:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>
    <!-- Thanh navbar -->
    <div class="navbar">
        <h1>Quản lý nhà thông minh</h1>
        <div class="nav-buttons">
            <button id="homePage">Trang chủ</button>
            <button id="airQualityBtn">Thống kê không khí</button>
            <button id="information">Thông tin cá nhân</button>
        </div>
    </div>

    <!-- Bộ lọc thời gian và tùy chọn sắp xếp -->
    <div class="filter-find-container">
        <!-- Bộ lọc thời gian -->
        <div class="filter-container">
            <label for="startDate">Từ ngày:</label>
            <input type="date" id="startTime">
            <label for="endDate">Đến ngày:</label>
            <input type="date" id="endTime">
            <button id="applyFilter">Lọc</button>
        </div>

        <!-- Sắp xếp -->
        <div class="find-container">
            <label for="findByDevice">Tìm kiếm theo:</label>
            <select id="findByDevice">
                <option value="none">Tất cả</option>
                <option value="fan">Quạt</option>
                <option value="airConditioner">Điều hòa</option>
                <option value="LED">Đèn LED</option>
            </select>
            <button id="applyFind">Tìm kiếm</button>
        </div>
    </div>

    <!-- Tiêu đề -->
    <div class="header-title">
        <h2>Lịch sử sử dụng thiết bị</h2>
    </div>

    <div class="container">
        <table>
            <thead>
                <tr>
                    <th>Số thứ tự</th>
                    <th>Tên thiết bị</th>
                    <th>Thời gian</th>
                    <th>Trạng thái</th>
                </tr>
            </thead>
            <tbody id="device-history"></tbody>
        </table>
        <div id="pagination" class="pagination">
            <button id="prev-page" onclick="changePage(-1)">←</button>
            <div id="page-numbers"></div>
            <button id="next-page" onclick="changePage(1)">→</button>
        </div>
    </div>

    <script>
        let deviceHistoryFiltered = []; // Mảng dữ liệu đã lọc
        let dataRendered = [];
        let currentPage = 0; // Trang hiện tại
        let totalPages = 0; // Tổng số trangg sau khi lọc


        // Tạo dữ liệu mẫu cho lịch sử thiết bị với 3 thiết bị cụ thể: Quạt, Điều hòa, và Đèn LED
        let deviceHistory = Array.from({ length: 100 }, (_, i) => {
            const deviceNames = ['Quạt', 'Điều hòa', 'Đèn LED'];
            return {
                name: deviceNames[i % 3],
                time: new Date(Date.now() - Math.floor(Math.random() * 1e9)).toISOString(),
                status: Math.random() > 0.5 ? 'Bật' : 'Tắt'
            };
        });


        // Hàm phân trang
        function paginate(items, itemsPerPage) {
            const pages = [];
            for (let i = 0; i < items.length; i += itemsPerPage) {
                pages.push(items.slice(i, i + itemsPerPage));
            }
            return pages;
        }


        // Hiển thị dữ liệu và phân trang
        function renderPage(pageNumber) {
            const itemsPerPage = 10; // 10 dữ liệu mỗi trang
            dataRendered = deviceHistoryFiltered.length > 0 ? deviceHistoryFiltered : deviceHistory;
            const pagedHistory = paginate(dataRendered, itemsPerPage);

            // console.log(deviceHistoryFiltered, deviceHistory);

            totalPages = pagedHistory.length; // cập nhật tổng số trang 

            const deviceHistoryTable = document.getElementById('device-history');
            const pageNumbers = document.getElementById('page-numbers');

            // Hiển thị dữ liệu trong bảng
            deviceHistoryTable.innerHTML = '';
            pagedHistory[pageNumber].forEach((device, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${pageNumber * itemsPerPage + index + 1}</td>
                    <td>${device.name}</td>
                    <td>${new Date(device.time).toLocaleString('vi-VN')}</td>
                    <td>${device.status}</td>
                `;
                deviceHistoryTable.appendChild(tr);
            });

            // Hiển thị số trang với ... ngăn cách
            const maxPageButtons = 4;

            pageNumbers.innerHTML = '';

            function createPageButton(i, isCurrent = false) {
                const button = document.createElement('button');
                button.textContent = i + 1;
                button.className = isCurrent ? 'active' : '';
                button.addEventListener('click', () => renderPage(i));
                pageNumbers.appendChild(button);
            }

            if (totalPages <= maxPageButtons + 2) {
                for (let i = 0; i < totalPages; i++) {
                    createPageButton(i, i === pageNumber);
                }
            } else {
                if (pageNumber < maxPageButtons - 1) {
                    for (let i = 0; i < maxPageButtons; i++) {
                        createPageButton(i, i === pageNumber);
                    }
                    pageNumbers.appendChild(document.createTextNode('...'));
                    createPageButton(totalPages - 1);
                } else if (pageNumber >= totalPages - maxPageButtons + 1) {
                    createPageButton(0);
                    pageNumbers.appendChild(document.createTextNode('...'));
                    for (let i = totalPages - maxPageButtons; i < totalPages; i++) {
                        createPageButton(i, i === pageNumber);
                    }
                } else {
                    createPageButton(0);
                    pageNumbers.appendChild(document.createTextNode('...'));
                    for (let i = pageNumber - 2; i <= pageNumber + 1; i++) {
                        createPageButton(i, i === pageNumber);
                    }
                    if (pageNumber + 1 < totalPages - 2) {
                        pageNumbers.appendChild(document.createTextNode('...'));
                    }
                    createPageButton(totalPages - 1);
                }
            }

            // Cập nhật trạng thái nút mũi tên
            currentPage = pageNumber;
            document.getElementById('prev-page').disabled = pageNumber === 0;
            document.getElementById('next-page').disabled = pageNumber === totalPages - 1;
        }

        // Chuyển đổi trang
        function changePage(direction) {
            const newPage = currentPage + direction;
            if (newPage >= 0 && newPage < totalPages) {
                renderPage(newPage);
            }
        }

        // Hàm lọc dữ liệu theo thời gian để hiển thị
        function filterDataByDay() {
            const startTimeInput = document.getElementById('startTime');
            const endTimeInput = document.getElementById('endTime');

            const startTime = new Date(startTimeInput.value).setHours(0, 0, 0, 0);
            const endTime = new Date(endTimeInput.value).setHours(23, 59, 59, 999);

            // Kiểm tra nếu ngày bắt đầu hoặc kết thúc bị để trống
            if (!startTimeInput.value || !endTimeInput.value) {
                alert("Vui lòng nhập đầy đủ ngày bắt đầu và ngày kết thúc.");
                return;
            }

            // Kiểm tra nếu ngày bắt đầu lớn hơn ngày kết thúc
            if (startTime > endTime) {
                alert("Ngày bắt đầu không thể lớn hơn ngày kết thúc.");
                return;
            }

            deviceHistoryFiltered = deviceHistory.filter(data => {
                const time = new Date(data.time);
                return time >= startTime && time <= endTime;
            });

            // Kiểm tra nếu không có dữ liệu phù hợp
            if (deviceHistoryFiltered.length === 0) {
                alert("Không có dữ liệu nào phù hợp với khoảng thời gian bạn đã chọn.");
            }

            document.getElementById('findByDevice').value = 'none'

            renderPage(0); // Hiển thị lại từ trang đầu sau khi lọc
        }

        // Hàm lọc mảng dữ liệu theo ngày dùng cho tìm thiết bị
        function findByDay(start, end) {
            const startTime = new Date(start);
            const endTime = new Date(end);

            startTime.setHours(0, 0, 0, 0);
            endTime.setHours(23, 59, 59, 999);

            return deviceHistory.filter(item => {
                const time = new Date(item.time);
                return time >= startTime && time <= endTime;
            })
        }

        function filterDataByDevice() {
            const option = document.getElementById('findByDevice').value;
            const start = document.getElementById('startTime').value;
            const end = document.getElementById('endTime').value;

            let data = []

            if(start && end) {
                data = findByDay(start, end);
            }
            else if ((!start && end) || (start && !end)) {
                alert('Không được để trống ô nhập ngày tháng');
                return;
            }
            else data = deviceHistory;

            let foundData = [];
            switch (option) {
                case 'fan':
                    foundData = data.filter((item) => item.name === 'Quạt');
                    break;
                case 'airConditioner':
                    foundData = data.filter((item) => item.name === 'Điều hòa');
                    break;
                case 'LED':
                    foundData = data.filter((item) => item.name === 'Đèn LED');
                    break;
                case 'none':
                    foundData = data;
                    break;
            }

            if (foundData.length === 0) {
                alert('Không có dữ liệu nào phù hợp.')
            }

            deviceHistoryFiltered = foundData;

            console.log(foundData, deviceHistoryFiltered, deviceHistory);

            // render 
            renderPage(0);
        }

        // Hiển thị trang đầu tiên
        renderPage(0);

        // Sự kiện cho các nút navbar
        document.getElementById('homePage').addEventListener('click', function () {
            window.location.href = 'index.html';
        });

        document.getElementById('airQualityBtn').addEventListener('click', function () {
            window.location.href = 'statistical.html';
        });

        document.getElementById('information').addEventListener('click', () => {
            window.location.href = 'info.html';
        })

        // Sự kiện Filter
        document.getElementById('applyFilter').addEventListener('click', filterDataByDay);

        // Sự kiện Search
        document.getElementById('applyFind').addEventListener('click', filterDataByDevice);

    </script>
</body>

</html>